<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Elissa Leung">

<title>MP #04: Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#cuny-retirement-plans" id="toc-cuny-retirement-plans" class="nav-link" data-scroll-target="#cuny-retirement-plans">CUNY Retirement Plans</a></li>
  </ul></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a>
  <ul class="collapse">
  <li><a href="#loading-api-keys" id="toc-loading-api-keys" class="nav-link" data-scroll-target="#loading-api-keys">Loading API Keys</a></li>
  </ul></li>
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">Data Acquisition</a></li>
  <li><a href="#investigation-and-visualization-of-input-data" id="toc-investigation-and-visualization-of-input-data" class="nav-link" data-scroll-target="#investigation-and-visualization-of-input-data">Investigation and Visualization of Input Data</a></li>
  <li><a href="#historical-comparison-of-trs-and-orp" id="toc-historical-comparison-of-trs-and-orp" class="nav-link" data-scroll-target="#historical-comparison-of-trs-and-orp">Historical Comparison of TRS and ORP</a>
  <ul class="collapse">
  <li><a href="#trs" id="toc-trs" class="nav-link" data-scroll-target="#trs">TRS</a></li>
  <li><a href="#orp" id="toc-orp" class="nav-link" data-scroll-target="#orp">ORP</a></li>
  </ul></li>
  <li><a href="#long-term-average-analysis" id="toc-long-term-average-analysis" class="nav-link" data-scroll-target="#long-term-average-analysis">Long-Term Average Analysis</a></li>
  <li><a href="#bootstrap-monte-carlo-comparison" id="toc-bootstrap-monte-carlo-comparison" class="nav-link" data-scroll-target="#bootstrap-monte-carlo-comparison">Bootstrap (Monte Carlo) Comparison</a>
  <ul class="collapse">
  <li><a href="#trs-1" id="toc-trs-1" class="nav-link" data-scroll-target="#trs-1">TRS</a></li>
  <li><a href="#orp-1" id="toc-orp-1" class="nav-link" data-scroll-target="#orp-1">ORP</a></li>
  </ul></li>
  <li><a href="#data-driven-decision-recommendation" id="toc-data-driven-decision-recommendation" class="nav-link" data-scroll-target="#data-driven-decision-recommendation">Data-Driven Decision Recommendation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MP #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Elissa Leung </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><img src="retirement.jpeg" class="img-fluid"></p>
<p>As life expectancy continues to increase, there is a greater need for long-term financial security in retirement. Individuals are compelled to start their retirement planning earlier on in their career. A retirement plan is a financial arrangement meant to help individuals save and/or invest money during their career so that this money could support them in retirement. There are various retirement plans (e.g.&nbsp;employer-sponsored plans, individual retirement accounts, etc.) that individuals can choose to contribute to based on various factors.</p>
<p>At the <a href="https://www.cuny.edu/">City University of New York (CUNY)</a>, new faculty members have 30 days to select between <a href="https://www.cuny.edu/wp-content/uploads/sites/4/page-assets/about/administration/offices/hr/benefits/Benefits-Guide-Retirement-Plans-Final-HEO-and-ECP.pdf">two retirement plans</a>. Given the long-term nature and significance of this decision, it is one that cannot be made lightly, as it will impact their financial security for the remainder of their lives during retirement.</p>
<section id="cuny-retirement-plans" class="level3">
<h3 class="anchored" data-anchor-id="cuny-retirement-plans">CUNY Retirement Plans</h3>
<p>CUNY offers its employees a choice between two retirement plans: the traditional defined-benefit Teachers Retirement System (TRS) plan and the more recent defined-contribution Optional Retirement Plan (ORP).</p>
<p><em>Throughout this project, we will be ignoring the effect of taxes since both of these plans offer pre-tax retirement savings.</em></p>
<section id="teachers-retirement-system" class="level4">
<h4 class="anchored" data-anchor-id="teachers-retirement-system">Teachers Retirement System</h4>
<p>The TRS traditional pension plan guarantees that in retirement, the employer (CUNY) will continue paying its employees a portion of their salary until death. This is a “defined-benefit” plan as the retirement benefit the employee ultimately receives is fixed a priori and the employer ends up taking the market risk.</p>
<p>At CUNY, the TRS is administered as follows:</p>
<ol type="1">
<li><p>Employees pay a fixed percentage of their paycheck into the pension fund. For CUNY employees joining after March 31, 2012–which you may assume for this project–the so-called “Tier VI” contribution rates are based on the employee’s annual salary and increase as follows:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul></li>
<li><p>The retirement benefit is calculated based on the <em>Final Average Salary</em> of the employee: following 2024 law changes, the FAS is computed based on the final <em>three</em> years salary. (Previously, FAS was computed based on 5 years: since salaries tend to increase monotonically over time, this is a major win for TRS participants.)</p>
<p>If <span class="math inline">N</span> is the number of years served, the annual retirement benefit is:</p>
<ul>
<li><span class="math inline">1.67\% * \text{FAS} * N</span> if <span class="math inline">N \leq 20</span></li>
<li><span class="math inline">1.75\% * \text{FAS} * N</span> if <span class="math inline">N = 20</span></li>
<li><span class="math inline">(35\% + 2\% * N) * \text{FAS}</span> if <span class="math inline">N \geq 20</span></li>
</ul>
<p>In each case, the benefit is paid out equally over 12 months.</p></li>
<li><p>The benefit is increased annually by 50% of the CPI, rounded <em>up</em> to the nearest tenth of a percent: <em>e.g.</em>, a CPI of 2.9% gives an inflation adjustment of 1.5%. The benefit is capped <em>below</em> at 1% and <em>above</em> at 3%, so a CPI of 10% leads to a 3% inflation adjustment while a CPI of 0% leads to a 1% inflation adjustment.</p>
<p>The inflation adjustement is effective each September and the CPI used is the aggregate monthly CPI of the previous 12 months; so the September 2024 adjustment depends on the CPI from September 2023 to August 2024.</p></li>
</ol>
</section>
<section id="optional-retirement-plan" class="level4">
<h4 class="anchored" data-anchor-id="optional-retirement-plan">Optional Retirement Plan</h4>
<p>In CUNY’s ORP option, the plan is more similar to the more commonly known 401(k) plan. In this plan, both the employee and employer contribute to the retirement account, which will then be invested into the employee’s choice of mutual funds (e.g.&nbsp;US equities, International equities, bonds, short-term debts, etc.). These investments continue to grow “tax-free” over the course of their career and in retirement until they are withdrawn. The employee takes a larger risk in this plan as once they retire and begin withdrawing funds, once the account dries up, there are no more additional funds. However, if their investment grows large enough they may have additional funds to pass down to immediate family upon death. The ORP is a defined-contribution plan since only the contributions during the employee’s career is fixed, the final balance depends on the market.</p>
<p>During retirement, employees have the choice of accessing and withdrawing funds at any rate, but with the nature of this retirement plan it is important to make rational withdrawal decisions. For this project, we will assume that the employee will be withdrawing 4% of the account’s value per year (<a href="https://www.schwab.com/learn/story/beyond-4-rule-how-much-can-you-spend-retirement">Schwab discussion</a>).</p>
<p>The funds available in a ORP account depend strongly on the investments chosen. For this analysis, you can assume that the ORP participants invest in a <a href="https://www.fidelity.com/mutual-funds/fidelity-fund-portfolios/freedom-funds">Fidelity Freedom Fund</a> with the following asset allocation:</p>
<ul>
<li>Age 25 to Age 49:
<ul>
<li>54% US Equities</li>
<li>36% International Equities</li>
<li>10% Bonds</li>
</ul></li>
<li>Age 50 to Age 59:
<ul>
<li>47% US Equities</li>
<li>32% International Equities</li>
<li>21% Bonds</li>
</ul></li>
<li>Age 60 to Age 74:
<ul>
<li>34% US Equities</li>
<li>23% International Equities</li>
<li>43% Bonds</li>
</ul></li>
<li>Age 75 or older:
<ul>
<li>19% US Equities</li>
<li>13% International Equities</li>
<li>62% Bonds</li>
<li>6% Short-Term Debt</li>
</ul></li>
</ul>
<p>Under the ORP, both the employee and the employer make monthly contributions to the employee’s ORP account. These contributions are calculated as a percentage of the employee’s annual salary. Specifically, the employee contributes at the same rate as the TRS:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>The employer contribution is fixed at:</p>
<ul>
<li>8% for the first seven years of employment at CUNY.</li>
<li>10% for all years thereafter.</li>
</ul>
<p>We will assume that the contributions from the employee and employer are immediately invested based on the asset allocations above.</p>
<p>The goal for this project is to use historical financial data and a bootstrap inference strategy to compare CUNY’s two retirement plans and provide data-driven recommendations for CUNY employees’ retirement planning.</p>
<p>We will be using data from two economic and financial data sources, AlphaVantage and the Federal Reserve Economic Data repository. AlphaVantage is a commercial stock market data provider that provides users with APIs for real-time and historical market data. While the Federal Reserve Economic Data (FRED) repository is an online database maintained by the Federal Reserve Bank of St.&nbsp;Louis, allowing users access to various economic data and financial indicators.</p>
</section>
</section>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<p>For this project, we will be accessing data from both AlphaVantage and FRED through their password-protected APIs. Before accessing these APIs, we will need to register for API keys for each of the respective APIs: <a href="https://www.alphavantage.co/support/#api-key">AlphaVantage registration</a> and <a href="https://fredaccount.stlouisfed.org/login/secure/">FRED registration</a>.</p>
<p>Below are some useful packages we will need to utilize throughout the project in our retirement planning analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install necessary packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"dplyr"</span>)) <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyverse"</span>)) <span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"sf"</span>)) <span class="fu">install.packages</span>(<span class="st">"sf"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"haven"</span>)) <span class="fu">install.packages</span>(<span class="st">"haven"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"DT"</span>)) <span class="fu">install.packages</span>(<span class="st">"DT"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gt"</span>)) <span class="fu">install.packages</span>(<span class="st">"gt"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggplot2"</span>)) <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"RColorBrewer"</span>)) <span class="fu">install.packages</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"stringr"</span>)) <span class="fu">install.packages</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"patchwork"</span>)) <span class="fu">install.packages</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gganimate"</span>)) <span class="fu">install.packages</span>(<span class="st">"gganimate"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"zoom"</span>)) <span class="fu">install.packages</span>(<span class="st">"zoom"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"gridExtra"</span>)) <span class="fu">install.packages</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"httr2"</span>)) <span class="fu">install.packages</span>(<span class="st">"httr2"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readxl"</span>)) <span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"ggcorrplot"</span>)) <span class="fu">install.packages</span>(<span class="st">"ggcorrplot"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages into R</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># different color palette options</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># inset plots</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoom) <span class="co"># zoom for plots</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra) <span class="co"># labels outside the plot</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) <span class="co"># reading excel files</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot) <span class="co"># correlation matrices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="loading-api-keys" class="level3">
<h3 class="anchored" data-anchor-id="loading-api-keys">Loading API Keys</h3>
<p>Once we’ve registered and received our unique API keys, we will need to load these keys, so that we can access them later as we send requests to get data from the APIs.</p>
<p>Below is the code to load in my personal API keys (replace with your individual key) for each of the APIs.</p>
<p><em>Personal keys are not meant to be displayed.</em></p>
<section id="alphavantage-api-key" class="level4">
<h4 class="anchored" data-anchor-id="alphavantage-api-key">AlphaVantage API Key</h4>
<p>Below is my personal AlphaVantage API key.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>alphavantage_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"API-Key-alphavantage.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fred-api-key" class="level4">
<h4 class="anchored" data-anchor-id="fred-api-key">FRED API Key</h4>
<p>Below is my personal FRED API key.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fred_api_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"API-Key-fred.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once we’ve registered and received our API keys for each data source, we can now set up and send requests to the APIs to retrieve the necessary data sources for our analysis.</p>
</section>
</section>
</section>
<section id="data-acquisition" class="level2">
<h2 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h2>
<p>Before beginning this project, we will need to retrieve some historical economic and financial data from the AlphaVantage and FRED APIs. More specifically, we will be retrieving data covering:</p>
<ul>
<li>Wage Growth</li>
<li>Inflation</li>
<li>US Equities</li>
<li>International Equities</li>
<li>Bond</li>
<li>Short-Term</li>
</ul>
<p>For each of these data set retrievals, we will be utilizing the functions from the <code>httr2</code> package. First, we will need to set up an API request with the <code>request()</code> function, we will define the URL and set up the respective parameters for the metrics we want to retrieve based on each API’s documentation (<a href="https://www.alphavantage.co/documentation/">AlphaVantage documentation</a> and <a href="https://fred.stlouisfed.org/docs/api/fred/">FRED documentation</a>). Then, after performing the request, we will need to read in the content from the API response. The data from AlphaVantage’s API can be formatted into a csv file, in which case we will use the <code>read_csv()</code> function. Whereas FRED’s API provides a slightly more challenging .zip Excel file format, in which case we will need to unzip the folder and read in the file with <code>read_excel()</code> from the <code>readxl</code> package.</p>
<p>Below are the 6 data sets retrieved from either the AlphaVantage or FRED API’s. There are various data sets to choose from for each of these metrics, the choice made is dependent on various factors such as the extent of historical data.</p>
<section id="wage-growth" class="level4">
<h4 class="anchored" data-anchor-id="wage-growth">Wage Growth</h4>
<p>For the wage growth data, we will retrieve data from the FRED API. Using the <code>series_id = FRBATLWGT3MMAUMHWGWSFT</code>, we will get the Wage Growth Tracker for Job Switchers, 3-Month Moving Average, Unweighted, Median Hourly Wage. This data set provides information on wage growth from 1997 to 2024.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Starts from 2006-2024</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">'wage.zip'</span>)){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  fred_req_wage <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="at">series_id =</span> <span class="st">"FRBATLWGT3MMAUMHWGWSFT"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">api_key =</span> fred_api_key,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">file_type =</span> <span class="st">"xls"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  fred_resp_wage <span class="ot">&lt;-</span> fred_req_wage <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  save_path_wage <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir, <span class="st">"/wage.zip"</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  fred_resp_wage <span class="sc">|&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_raw</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeBin</span>(save_path_wage)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>save_path_wage <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dir, <span class="st">"/wage.zip"</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>td <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>zip_contents_wage <span class="ot">&lt;-</span> <span class="fu">unzip</span>(save_path_wage,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> td)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>fred_wage <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(zip_contents_wage,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Below is the code to select the relevant columns we will use in our analysis and rename columns for ease of interpretation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>wage_growth_data <span class="ot">&lt;-</span> fred_wage <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'observation_date'</span>, <span class="st">'FRBATLWGT3MMAUMHWGWSFT'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">wage_growth =</span> <span class="st">'FRBATLWGT3MMAUMHWGWSFT'</span>) <span class="co"># annualized median wage growth rate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="inflation" class="level4">
<h4 class="anchored" data-anchor-id="inflation">Inflation</h4>
<p>For our inflation data set, we will be retrieving the Consumer Price Index (CPI) of the United States data from the AlphaVantage API. The CPI measures the average change over time in the prices for a basket of goods and services purchased by consumers. Later, we will calculate the change in CPI to determine the inflation rates per period.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cpi_alphavantage_req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'CPI'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">apikey =</span> alphavantage_api_key,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">datatype =</span> <span class="st">'csv'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>cpi_resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(cpi_alphavantage_req)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>cpi_csv <span class="ot">&lt;-</span> cpi_resp <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Renaming the column for ease of JOINs later</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>cpi <span class="ot">&lt;-</span> cpi_csv <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cpi =</span> <span class="st">'value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="us-equity-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="us-equity-market-returns">US Equity Market Returns</h4>
<p>We will retrieve data on the US Equity market through the AlphaVantage API. Using AlphaVantage’s <code>TIME_SERIES_MONTHLY_ADJUSTED</code> function, we can retrieve data on the Vanguard Total Stock Market ETF (<code>symbol = VTI</code>) to represent the US Equity historical market returns for our project. This data set provides monthly data from 2001 to 2004 on the US Equity market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>vti_alphavantage_req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'TIME_SERIES_MONTHLY_ADJUSTED'</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">symbol =</span> <span class="st">'VTI'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">apikey =</span> alphavantage_api_key,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">datatype =</span> <span class="st">'csv'</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>vti_resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(vti_alphavantage_req)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>VTI_csv <span class="ot">&lt;-</span> vti_resp <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>us_equity <span class="ot">&lt;-</span> VTI_csv <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'timestamp'</span>, <span class="st">'adjusted close'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">us_equity_adj_close =</span> <span class="st">'adjusted close'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="international-equity-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="international-equity-market-returns">International Equity Market Returns</h4>
<p>We will also retrieve data on the International Equity market through AlphaVantage. Similarly, using AlphaVantage’s <code>TIME_SERIES_MONTHLY_ADJUSTED</code> function, we can retrieve data on the Vanguard International Growth Fund Investor Shares (<code>symbol = VWIGX</code>) to represent the International Equity historical market returns for our project. This data set provides monthly data from 1999 to 2004 on the US Equity market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>vwigx_alphavantage_req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'TIME_SERIES_MONTHLY_ADJUSTED'</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">symbol =</span> <span class="st">'VWIGX'</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">apikey =</span> alphavantage_api_key,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">datatype =</span> <span class="st">'csv'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>vwigx_resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(vwigx_alphavantage_req)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>VWIGX_csv <span class="ot">&lt;-</span> vwigx_resp <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>int_equity <span class="ot">&lt;-</span> VWIGX_csv <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'timestamp'</span>, <span class="st">'adjusted close'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">int_equity_adj_close =</span> <span class="st">'adjusted close'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="bond-market-returns" class="level4">
<h4 class="anchored" data-anchor-id="bond-market-returns">Bond market returns</h4>
<p>For the historical bond market values, we will use AlphaVantage’s <code>TREASURY_YIELD</code> function and set maturity at <code>10year</code> for our API request. The resulting data set provides monthly data on the interest rates that investors earn on bonds from 1953 to 2024. We will use this data set to represent historical bond values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>bond_alphavantage_req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'TREASURY_YIELD'</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">maturity =</span> <span class="st">"10year"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">apikey =</span> alphavantage_api_key,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">datatype =</span> <span class="st">'csv'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>bond_resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(bond_alphavantage_req)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>bond_csv <span class="ot">&lt;-</span> bond_resp <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bond <span class="ot">&lt;-</span> bond_csv <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bond_value =</span> <span class="st">'value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="short-term-debt-returns" class="level4">
<h4 class="anchored" data-anchor-id="short-term-debt-returns">Short-Term Debt Returns</h4>
<p>Lastly, for short-term debt values, we will also use AlphaVantage’s <code>TREASURY_YIELD</code> function, however, now we will set maturity at <code>2year</code> for our API request. The resulting data set provides monthly data on the the interest rates that investors earn on short-term debt from 1976 to 2024. We will use this data set to represent historical short-term debt values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>short_alphavantage_req <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'TREASURY_YIELD'</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">maturity =</span> <span class="st">"2year"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">apikey =</span> alphavantage_api_key,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">datatype =</span> <span class="st">'csv'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>short_resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(short_alphavantage_req)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>short_csv <span class="ot">&lt;-</span> short_resp <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resp_body_string</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>short_term <span class="ot">&lt;-</span> short_csv <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">short_term_value =</span> <span class="st">'value'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="investigation-and-visualization-of-input-data" class="level2">
<h2 class="anchored" data-anchor-id="investigation-and-visualization-of-input-data">Investigation and Visualization of Input Data</h2>
<p>Before beginning our retirement plan comparison analysis, we will do some preliminary exploration analysis on the 6 data sets imported to get familiar with our data. For the purposes of this project and to maintain consistency, we will only use data from the last 20 years (2005-2024).</p>
<p>Let’s first take a look at the wage growth and inflation data sets. Taking a look at the wage growth and inflation data simultaneously gives us a better understanding of the purchasing power and living standards of each specific time period. Both these metrics will be important for individuals’ financial planning throughout their career.</p>
<p>Below is the data frame combining the two metrics and calculate the inflation based on the change in CPI per month.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>comparison_inflation_vs_wage_growth <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(wage_growth_data, cpi, <span class="fu">join_by</span>(<span class="st">'observation_date'</span> <span class="sc">==</span> <span class="st">'timestamp'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(observation_date) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inflation =</span> <span class="fu">round</span>(((cpi <span class="sc">-</span> <span class="fu">lag</span>(cpi)) <span class="sc">/</span> <span class="fu">lag</span>(cpi)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;</span> <span class="dv">2004</span>) <span class="co"># We will only be working with data from the past 20 years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Taking a look at the scatter plot between inflation and wage growth, there doesn’t seem to be any correlation between the two metrics, as most of the data is randomly scattered with no obvious pattern or trend.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>comparison_inflation_vs_wage_growth <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> inflation, <span class="at">y =</span> wage_growth)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Inflation versus Wage Growth"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Inflation"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wage Growth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/wg_inf_scatter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, let’s take a closer look at the time-series plots for each of these metrics.</p>
<p>In the wage growth scatter plot, we can observe that between about 2005 and 2008, the wage growth fluctuates slightly between about 3.5% and 4.5%. However, there is a significant dip in wage growth afterwards until late 2010 to under 2%. The remainder of the wage growth percentages generally increase from 2010 onwards.</p>
<p>In the inflation scatter plot, inflation seems to remain consistently between -1% and 1% for most periods, with less of a pattern compared to the wage growth plot. However, there are a few outliers, notably in 2008-10-01, 2008-11-01, 2008-12-01, where the inflation rate drops below -1%. Given that there was a recession in 2008 during the <a href="https://en.wikipedia.org/wiki/2007%E2%80%932008_financial_crisis">Global Financial Crisis</a>, these values make sense.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>wage_growth_scatter <span class="ot">&lt;-</span> comparison_inflation_vs_wage_growth <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> observation_date, <span class="at">y =</span> wage_growth)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"Wage Growth Rate Over Time (Monthly)"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Wage Growth Rate"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>inflation_scatter <span class="ot">&lt;-</span> comparison_inflation_vs_wage_growth <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> observation_date, <span class="at">y =</span> inflation)) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"Inflation Rate Over Time (Monthly)"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Inflation Rate"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(wage_growth_scatter, inflation_scatter, <span class="at">top =</span> <span class="st">"Time Series: Wage Growth and Inflation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/time_series_wg_inflation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, we will take a look at the equities market return fluctuations and compare the US Equity market with the International Equity market from 2005 to 2024.</p>
<p>Below is the data frame that joins the two data tables US equity and international equity and calculates the returns for each equity market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join all the monthly market data together</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusting the date in the equities data to the first of the month for simplicity of JOINs (Ex: January 31 will become February 1, and so on)</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>equities <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(us_equity, int_equity, <span class="at">by =</span> <span class="st">'timestamp'</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(timestamp) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">us_equity_returns =</span> <span class="fu">round</span>(((us_equity_adj_close <span class="sc">-</span> <span class="fu">lag</span>(us_equity_adj_close)) <span class="sc">/</span> <span class="fu">lag</span>(us_equity_adj_close)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">int_equity_returns =</span> <span class="fu">round</span>(((int_equity_adj_close <span class="sc">-</span> <span class="fu">lag</span>(int_equity_adj_close)) <span class="sc">/</span> <span class="fu">lag</span>(int_equity_adj_close)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timestamp =</span> <span class="fu">ceiling_date</span>(timestamp, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'us_equity_adj_close'</span>, <span class="st">'int_equity_adj_close'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(timestamp) <span class="sc">&gt;</span> <span class="dv">2004</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we plot the US Equity market returns against the International Equity market returns. From a preliminary observation of the scatter plot, there seems to be a strong positive correlation between these two metrics. This may indicate a pattern that as the US Equity market returns increase so does the International Equity’s market returns. These markets are likely highly correlated due to factors like global events and/or policies that may impact these markets simultaneously.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>equities <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> us_equity_returns,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> int_equity_returns)) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Equity Market Returns vs International Equity Market Returns"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"US Equity Market Returns"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"International Equity Market Returns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/equity_market_returns_scatter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s also take a look at the time-series for the returns of each equity market. Below, we can observe that each of these markets have a relatively constant fluctuation over time. Both smooth lines plotted for each scatter plot remain around the 0% return line, indicating that the market returns are centered around 0 and a lack of a discernible trend over time. For the US Equity market, most of the returns remain within -10% and 10%. However, there is a noticeable outlier in the US Equity market on 2008-11-01 with a return of -17.48%. Similarly, in the same period, the International Equity market experienced returns of -22.81%. Both of these lulls occurring in 2008 during the Global Financial Crisis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>us_equity_scatter <span class="ot">&lt;-</span> equities <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> us_equity_returns)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"US Equity Returns Over Time (Monthly)"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"US Equity Returns"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>int_equity_scatter <span class="ot">&lt;-</span> equities <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> int_equity_returns)) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"International Equity Returns Over Time (Monthly)"</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"International Equity Returns"</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(us_equity_scatter, int_equity_scatter, <span class="at">top =</span> <span class="st">"Time Series: US vs International Equity Returns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/time_series_us_int-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lastly, we will be exploring the treasuries market, more specifically, we’ll compare the bond returns against the short-term debt returns from 2005 to 2024.</p>
<p>Below is the code joining the two tables together into one us treasuries table.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>us_treasury_comparison <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bond, short_term, <span class="at">by =</span> <span class="st">"timestamp"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(timestamp) <span class="sc">&gt;</span> <span class="dv">2004</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">timestamp</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First, we’ll take a look at the bonds vs the short-term debt returns scatter plot. There seems to be, for the most part, a strong positive correlation between these two metrics. Both these returns are sensitive to interest rate changes and market conditions, so their returns may end up synchronized.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>us_treasury_comparison <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bond_value, <span class="at">y =</span> short_term_value)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US Treasury Returns Over Time (Monthly)"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Bonds Return"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Short-Term Return"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/us_treasury_returns_scatter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Then, taking a look at the time-series for the bond returns and the short-term debt returns, we have that they have a similar general trend of starting off high, then decreasing for a while before increasing again. In both plots, there is an obvious dip in returns between 2020 and 2022, which is likely due to the global pandemic that severely impacted global economies.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bond_scatter <span class="ot">&lt;-</span> us_treasury_comparison <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> bond_value)) <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"Bond Returns Over Time (Monthly)"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Bond Returns"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>short_term_scatter <span class="ot">&lt;-</span> us_treasury_comparison <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> timestamp, <span class="at">y =</span> short_term_value)) <span class="sc">+</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="st">"Short-Term Returns Over Time (Monthly)"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Date (Monthly Periods)"</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Short-Term Returns"</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(bond_scatter, short_term_scatter, <span class="at">top =</span> <span class="st">"Time Series: Bond Market vs Short-Term Debt Returns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/time_series_bond_short-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The last thing, I would like to explore is the actual calculated correlation coefficient between each of these metrics. Before running the correlation, we will need to join all the tables into one, <code>all_metrics</code> table for ease of accessibility. Next, using the <code>ggcorrplot</code> package, we can calculate the correlation between each of the factors and plot this onto a correlation heat map matrix.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All metrics in one data frame to calculate correlations between each metric</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>all_metrics <span class="ot">&lt;-</span> comparison_inflation_vs_wage_growth <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(equities, <span class="fu">join_by</span>(<span class="st">"observation_date"</span> <span class="sc">==</span> <span class="st">"timestamp"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(us_treasury_comparison, <span class="fu">join_by</span>(<span class="st">"observation_date"</span> <span class="sc">==</span> <span class="st">"timestamp"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"cpi"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation Matrix</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="ot">&lt;-</span> all_metrics <span class="sc">|&gt;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"observation_date"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Wage Growth</span><span class="st">`</span> <span class="ot">=</span> wage_growth,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Inflation =</span> inflation,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">US Equity Returns</span><span class="st">`</span> <span class="ot">=</span> us_equity_returns,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">International Equity Returns</span><span class="st">`</span> <span class="ot">=</span> int_equity_returns,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Bond Returns</span><span class="st">`</span> <span class="ot">=</span> bond_value,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Short-Term Debt Returns</span><span class="st">`</span> <span class="ot">=</span> short_term_value) <span class="sc">|&gt;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="sc">|&gt;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggcorrplot</span>(<span class="at">lab =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/all_metrics_comparison_correlation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similar to the analysis we did prior to this, there is a strong positive correlation between US Equity returns and International Equity returns with a correlation coefficient of <strong>0.86</strong> and also a strong positive correlation between Bond returns and Short-Term Debt returns with a correlation coefficient of <strong>0.83</strong>. An additional interesting observation is that there is a relatively strong positive relationship between wage growth and short-term debt returns as well, with a correlation coefficient of <strong>0.69</strong>. The remaining values indicate a weak or even non-discernible correlation.</p>
<p>To take a closer look at each metric, we will summarize each metric’s monthly data into annual summaries. Since our wage growth data, bond value data, and short-term value data are all <em>annual</em> percentages, we will take the average between the 12-month period for the aggregate value. On the other hand, our inflation, US equity return, and International equity return data are monthly values, so we will follow the formula:</p>
<p><span class="math display">
Aggregate = (\prod (1 + value / 100)) - 1
</span> Where <em>value</em> represents either inflation, US equity return or International equity return.</p>
<p>Below is the data table that shows all of our aggregated values for each of the metrics for each year of data we will be utilizing in our calculations. Taking a look at some of the data we saw that stood out in some of the scatter plots earlier, we can see that in 2008, there was an average market return of -38.51% for the US Equity market and a -50.01% for the International equity market. Inflation also took a hit at 0.1% compared to the 4.08% from 2007.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>all_metrics_summary <span class="ot">&lt;-</span> all_metrics <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(observation_date),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(observation_date)) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">annual_wage_growth =</span> <span class="fu">round</span>(<span class="fu">mean</span>(wage_growth), <span class="dv">2</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">annual_inflation =</span> <span class="fu">round</span>((<span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> (inflation <span class="sc">/</span> <span class="dv">100</span>)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">annual_us_equity_returns =</span> <span class="fu">round</span>((<span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> (us_equity_returns <span class="sc">/</span> <span class="dv">100</span>)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">annual_int_equity_returns =</span> <span class="fu">round</span>((<span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> (int_equity_returns <span class="sc">/</span> <span class="dv">100</span>)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">annual_bond_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bond_value), <span class="dv">2</span>),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">annual_short_term_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(short_term_value), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(all_metrics_summary, <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Average Wage Growth"</span>, <span class="st">"Average Inflation"</span>, <span class="st">"Average US Equity Returns"</span>, <span class="st">"Average International Equity"</span>, <span class="st">"Average Bond Retuns"</span>, <span class="st">"Average Short-Term Debt Returns"</span>)), </span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 1: Averages of All Metrics per Year"</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-549628f7e06b45c9b3eb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-549628f7e06b45c9b3eb">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 1: Averages of All Metrics per Year<\/caption>","data":[[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],[4,4,4.35,4.13,2.92,1.84,2.19,2.44,2.54,2.74,3.28,3.66,3.54,3.51,3.77,3.67,3.74,6.25,5.73,4.96],[3.42,2.55,4.08,0.1,2.72,1.48,2.96,1.75,1.52,0.75,0.74,2.06,2.11,1.93,2.28,1.36,7.04,6.45,3.36,2.91],[9.94,14.35,7.4,-38.51,27.53,12.93,6.98,16.07,31.6,15.67,2.5,8.279999999999999,22.2,5.56,15.48,18.85,26.79,-11.27,12.74,26.97],[13.82,28.9,22.1,-50.01,50.39,9.119999999999999,-4.24,12.27,24.71,1.29,-2.93,-1.07,42.01,-5.33,15.71,58.37,6.99,-35.57,4.07,21.18],[4.29,4.79,4.63,3.67,3.26,3.21,2.79,1.8,2.35,2.54,2.14,1.84,2.33,2.91,2.14,0.89,1.44,2.95,3.96,4.18],[3.85,4.82,4.36,2,0.96,0.7,0.45,0.28,0.31,0.46,0.6899999999999999,0.84,1.4,2.53,1.97,0.4,0.26,2.98,4.58,4.4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Average Wage Growth<\/th>\n      <th>Average Inflation<\/th>\n      <th>Average US Equity Returns<\/th>\n      <th>Average International Equity<\/th>\n      <th>Average Bond Retuns<\/th>\n      <th>Average Short-Term Debt Returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5,6]},{"name":"Year","targets":0},{"name":"Average Wage Growth","targets":1},{"name":"Average Inflation","targets":2},{"name":"Average US Equity Returns","targets":3},{"name":"Average International Equity","targets":4},{"name":"Average Bond Retuns","targets":5},{"name":"Average Short-Term Debt Returns","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Additionally, before we compute estimated retirement projections, we will need to calculate long-run averages for each metric (wage growth, inflation, US equity returns, International equity returns, bond returns, short-term debt returns). Since we do not have information on the future, we will be using the long-run average of each metric to project the CUNY employee’s retirement based on certain assumptions.</p>
<p>Below is the data frame containing all the long-run averages for each metric. At first glance, the long-run average market returns for each of the equity markets seem a little aggressive, but based on the averages from the table above, the various global events and market dynamics, it checks out. Comparatively, both the long-run averages for the bond returns and short-term debt returns are lower at 2.91% and 1.91%, which makes sense given that these assets are less risky and typically provide less aggressive returns.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>long_run_averages <span class="ot">&lt;-</span> all_metrics_summary <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">long_run_wage_growth =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_wage_growth), <span class="dv">2</span>), <span class="co"># already annualized</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_inflation =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_inflation), <span class="dv">2</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_us_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_us_equity_returns), <span class="dv">2</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_int_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_int_equity_returns), <span class="dv">2</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_bond_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_bond_value), <span class="dv">2</span>), <span class="co"># already annualized</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_short_term_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_short_term_value), <span class="dv">2</span>)) <span class="co"># already annualized</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(long_run_averages, <span class="fu">c</span>(<span class="st">"Average Wage Growth"</span>, <span class="st">"Average Inflation"</span>, <span class="st">"Average US Equity Returns"</span>, <span class="st">"Average International Equity"</span>, <span class="st">"Average Bond Retuns"</span>, <span class="st">"Average Short-Term Debt Returns"</span>)), </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 2: Long-Run Averages of All Metrics"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-862622b35079f09f478a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-862622b35079f09f478a">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 2: Long-Run Averages of All Metrics<\/caption>","data":[[3.66],[2.58],[11.6],[10.59],[2.91],[1.91]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Average Wage Growth<\/th>\n      <th>Average Inflation<\/th>\n      <th>Average US Equity Returns<\/th>\n      <th>Average International Equity<\/th>\n      <th>Average Bond Retuns<\/th>\n      <th>Average Short-Term Debt Returns<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5]},{"name":"Average Wage Growth","targets":0},{"name":"Average Inflation","targets":1},{"name":"Average US Equity Returns","targets":2},{"name":"Average International Equity","targets":3},{"name":"Average Bond Retuns","targets":4},{"name":"Average Short-Term Debt Returns","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="historical-comparison-of-trs-and-orp" class="level2">
<h2 class="anchored" data-anchor-id="historical-comparison-of-trs-and-orp">Historical Comparison of TRS and ORP</h2>
<p>Now that we’ve retrieved our data sets and performed some preliminary exploratory analysis, we can begin our CUNY retirement plan analysis. For this analysis, we will implement the TRS and ORP formulas introduced earlier, utilizing the data sets we obtained from AlphaVantage and FRED to represent market fluctuations over time. Before beginning analysis we will need to make a few assumptions for our CUNY employee. We will assume that our hypothetical CUNY employee:</p>
<ul>
<li>Joined CUNY in January of 2005 at age 35 with a starting salary of $50,000</li>
<li>Retired from CUNY at the end of October 2024 at age 54</li>
<li>Worked for 20 years in CUNY</li>
<li>Dies at age 77</li>
</ul>
<p>We will first calculate the CUNY employee’s salary each year of their career (2005-2024) based on our annual aggregated wage growth and inflation data. To adjust for wage growth, we will follow the following formula:</p>
<p><span class="math display">
salary_w = salary_p * (1 + (WG / 100))
</span></p>
<p>Where:</p>
<ul>
<li>salary<sub>p</sub>: salary from the previous year</li>
<li>WG: wage growth percentage</li>
<li>salary<sub>w</sub>: salary after wage growth adjustments</li>
</ul>
<p>Then, to adjust for yearly inflation, we will use:</p>
<p><span class="math display">
salary_f = \frac{salary_w}{1-(i/100)}
</span></p>
<p>Where:</p>
<ul>
<li>salary<sub>w</sub>: salary after wage growth adjustments</li>
<li>i: inflation rate</li>
<li>salary<sub>f</sub>: final salary after wage growth and inflation adjustments</li>
</ul>
<p>Below is the data frame containing all the final calculations for salary based on the wage growth rate and inflation rate data. Based on our calculations, in about 15 years, the employee will have doubled their starting salary to $102,242.56. By the time the employee retires in 20 years, they would have tripled their initial starting salary at $161,085.94.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>yearly_wage_growth <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_wage_growth</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>yearly_inflation <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_inflation</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>salary_vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50000</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(yearly_wage_growth)) {</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  start_salary <span class="ot">=</span> salary_vector[i<span class="dv">-1</span>]</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  salary <span class="ot">=</span> (start_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (yearly_wage_growth[i] <span class="sc">/</span> <span class="dv">100</span>))) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> (yearly_inflation[i] <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  salary_vector <span class="ot">=</span> <span class="fu">c</span>(salary_vector, salary)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>yearly_salary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> (<span class="dv">2005</span><span class="sc">:</span><span class="dv">2024</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">salary =</span> salary_vector) <span class="sc">|&gt;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salary =</span> <span class="fu">round</span>(salary, <span class="dv">2</span>))</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(yearly_salary_df, <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Salary After Adjustments"</span>)), </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 3: Employee Salary After Adjustments to Wage Growth and Inflation"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a82ba11af5ab7b39c693" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a82ba11af5ab7b39c693">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 3: Employee Salary After Adjustments to Wage Growth and Inflation<\/caption>","data":[[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],[50000,53360.7,58050.34,60508.33,64016.42,66173.69,69685.59,72657.42,75652.84,78313.08,81484.74000000001,86243.7,91221.5,96281.61,102242.56,107456.26,119917.3,136196.83,149007.56,161085.94]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Salary After Adjustments<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"Year","targets":0},{"name":"Salary After Adjustments","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Now, based on these salary calculations we will run our simulation for each retirement plan and compare each of values at the first month of retirement.</p>
<section id="trs" class="level3">
<h3 class="anchored" data-anchor-id="trs">TRS</h3>
<p>For the TRS retirement plan, the employee will pay a fixed percentage of their paycheck into the pension fund, based on the following contribution rates and annual salary brackets:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>Below is the code calculating the total contributions the employee provides to the pension each year of their career at CUNY.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Employees pay a fixed percentage of their paycheck into the pension fund</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>trs_pension <span class="ot">&lt;-</span> yearly_salary_df <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tier_6 =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    salary <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">45000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.035</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">55000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.045</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.0575</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    salary <span class="sc">&gt;</span> <span class="dv">100000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">2</span>))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>total_contribution <span class="ot">&lt;-</span> trs_pension <span class="sc">|&gt;</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(tier_6)) <span class="sc">|&gt;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(trs_pension, <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Salary After Adjustments"</span>, <span class="st">"Total Contributions"</span>)), </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 4: TRS Yearly Pension Contributions"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5fad95870644d44014cc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5fad95870644d44014cc">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 4: TRS Yearly Pension Contributions<\/caption>","data":[[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],[50000,53360.7,58050.34,60508.33,64016.42,66173.69,69685.59,72657.42,75652.84,78313.08,81484.74000000001,86243.7,91221.5,96281.61,102242.56,107456.26,119917.3,136196.83,149007.56,161085.94],[1750,1867.62,2612.27,2722.87,2880.74,2977.82,3135.85,3269.58,4350.04,4503,4685.37,4959.01,5245.24,5536.19,6134.55,6447.38,7195.04,8171.81,8940.450000000001,9665.16]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Salary After Adjustments<\/th>\n      <th>Total Contributions<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2]},{"name":"Year","targets":0},{"name":"Salary After Adjustments","targets":1},{"name":"Total Contributions","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>After 20 years of employment with CUNY, under the TRS pension plan, this employee would have contributed a total of $97,049.99.</p>
<p>Next, we’ll need to calculate the employee’s final average salary (FAS) based on their salary in their last three years of employment, so in this case it would be 2022, 2023, and 2024. The final average salary based on these three years of employment came out to $148,763.44. We will then use this FAS towards calculating the employee’s annual retirement benefit. We will consider the following cases when calculating the first year’s retirement benefit:</p>
<ul>
<li><span class="math inline">1.67\% * \text{FAS} * N</span> if <span class="math inline">N \leq 20</span></li>
<li><span class="math inline">1.75\% * \text{FAS} * N</span> if <span class="math inline">N = 20</span></li>
<li><span class="math inline">(35\% + 2\% * N) * \text{FAS}</span> if <span class="math inline">N \geq 20</span></li>
</ul>
<p>Since our employee worked for 20 years, we will be using the second formula to calculate their initial retirement benefit.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. The retirement benefit is calculated based on the Final Average Salary of the employee (last three years of work)</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>final_average_salary <span class="ot">&lt;-</span> yearly_salary_df <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fas =</span> <span class="fu">round</span>(<span class="fu">mean</span>(salary), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(fas)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>retirement_benefit_trs <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(yearly_salary_df) <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="fl">0.0167</span> <span class="sc">*</span> final_average_salary <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(yearly_salary_df) <span class="sc">==</span> <span class="dv">20</span> <span class="sc">~</span> <span class="fl">0.0175</span> <span class="sc">*</span> final_average_salary <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(yearly_salary_df) <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">~</span> (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df)) <span class="sc">*</span> final_average_salary,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After all calculations, we will find that the employee will receive an annual retirement payment in 2025 of $52,067.2, or a monthly payout of $4,338.93.</p>
<p>Next, we will take a look at the first month’s payout from CUNY’s Optional Retirement Plan (ORP).</p>
</section>
<section id="orp" class="level3">
<h3 class="anchored" data-anchor-id="orp">ORP</h3>
<p>In the CUNY ORP, the employees contribute at the same rate as the TRS, with the following brackets:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>However, now the employee’s are contributing directly to their own retirement into their ORP account. Their employers, CUNY in this case, will also contribute a fraction of their employee’s salary based on these conditions:</p>
<ul>
<li>8% for the first seven years of employment at CUNY.</li>
<li>10% for all years thereafter.</li>
</ul>
<p>Below is the code to create the data frame containing all the employee and employer contributions based on salary and years of employment from 2005 to 2024.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>orp_account <span class="ot">&lt;-</span> yearly_salary_df <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orp_contributions =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    salary <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">45000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.035</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">55000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.045</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.0575</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    salary <span class="sc">&gt;</span> <span class="dv">100000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">employer_contributions =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    (year <span class="sc">-</span> <span class="dv">2005</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&lt;=</span> <span class="dv">7</span> <span class="sc">~</span> <span class="fl">0.08</span> <span class="sc">*</span> salary,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="fl">0.1</span> <span class="sc">*</span> salary</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_contributions =</span> <span class="fu">round</span>(orp_contributions <span class="sc">+</span> employer_contributions, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> (<span class="dv">35</span><span class="sc">:</span><span class="dv">54</span>))</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(orp_account, <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Salary After Adjustments"</span>, <span class="st">"Employee Contributions"</span>, <span class="st">"Employer Contributions"</span>, <span class="st">"Total Contributions"</span>, <span class="st">"Age"</span>)), </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 5: ORP Employee and Employer Yearly Contributions"</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ad1aeba3724419357739" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ad1aeba3724419357739">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 5: ORP Employee and Employer Yearly Contributions<\/caption>","data":[[2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],[50000,53360.7,58050.34,60508.33,64016.42,66173.69,69685.59,72657.42,75652.84,78313.08,81484.74000000001,86243.7,91221.5,96281.61,102242.56,107456.26,119917.3,136196.83,149007.56,161085.94],[1750,1867.62,2612.27,2722.87,2880.74,2977.82,3135.85,3269.58,4350.04,4503,4685.37,4959.01,5245.24,5536.19,6134.55,6447.38,7195.04,8171.81,8940.450000000001,9665.16],[4000,4268.86,4644.03,4840.67,5121.31,5293.9,5574.85,7265.74,7565.28,7831.31,8148.47,8624.370000000001,9122.15,9628.16,10224.26,10745.63,11991.73,13619.68,14900.76,16108.59],[5750,6136.48,7256.3,7563.54,8002.05,8271.719999999999,8710.700000000001,10535.32,11915.32,12334.31,12833.84,13583.38,14367.39,15164.35,16358.81,17193.01,19186.77,21791.49,23841.21,25773.75],[35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Salary After Adjustments<\/th>\n      <th>Employee Contributions<\/th>\n      <th>Employer Contributions<\/th>\n      <th>Total Contributions<\/th>\n      <th>Age<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5]},{"name":"Year","targets":0},{"name":"Salary After Adjustments","targets":1},{"name":"Employee Contributions","targets":2},{"name":"Employer Contributions","targets":3},{"name":"Total Contributions","targets":4},{"name":"Age","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>ORP is a retirement plan that invests these contributions into the employee’s choice of mutual funds, for this project, we will assume that our employee invests in a Fidelity Freedom Fund, which allocates assets the following way:</p>
<ul>
<li>Age 25 to Age 49:
<ul>
<li>54% US Equities</li>
<li>36% International Equities</li>
<li>10% Bonds</li>
</ul></li>
<li>Age 50 to Age 59:
<ul>
<li>47% US Equities</li>
<li>32% International Equities</li>
<li>21% Bonds</li>
</ul></li>
<li>Age 60 to Age 74:
<ul>
<li>34% US Equities</li>
<li>23% International Equities</li>
<li>43% Bonds</li>
</ul></li>
<li>Age 75 or older:
<ul>
<li>19% US Equities</li>
<li>13% International Equities</li>
<li>62% Bonds</li>
<li>6% Short-Term Debt</li>
</ul></li>
</ul>
<p>So, based on the age of the employee, we will need to allocate the annual contributions accordingly. We will also need to account for the market fluctuation of each of these assets. So we’ll use the annual aggregated data for each of the markets (US Equity, International Equity, Bonds, and Short-Term Debts) to adjust the retirement account balance before the start of the following year.</p>
<p>Below is the code to calculate all the above steps and to ultimately calculate the final balance once the employee retires and stops contributing.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectors from the data frame to run a for loop on to calculate total retirement benefit by the time of retirement</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> orp_account<span class="sc">$</span>age</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>total_contributions <span class="ot">&lt;-</span> orp_account<span class="sc">$</span>total_contributions</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectors for each market's returns</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>us_equity_yearly <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_us_equity_returns</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>int_equity_yearly <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_int_equity_returns</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>bond_yearly <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_bond_value</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>short_term_yearly <span class="ot">&lt;-</span> all_metrics_summary<span class="sc">$</span>annual_short_term_value</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initially no investment into any of these assets</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>us_equities_total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>int_equities_total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>bonds_total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>short_term_total <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Asset allocation based on age of employee</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    us_equities_total <span class="ot">&lt;-</span> us_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.54</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    int_equities_total <span class="ot">&lt;-</span> int_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.36</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    bonds_total <span class="ot">&lt;-</span> bonds_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    short_term_total <span class="ot">&lt;-</span> short_term_total</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">60</span>) {</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    us_equities_total <span class="ot">&lt;-</span> us_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.47</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    int_equities_total <span class="ot">&lt;-</span> int_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.32</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    bonds_total <span class="ot">&lt;-</span> bonds_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.21</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    short_term_total <span class="ot">&lt;-</span> short_term_total</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">75</span>) {</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>    us_equities_total <span class="ot">&lt;-</span> us_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.34</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    int_equities_total <span class="ot">&lt;-</span> int_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.23</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    bonds_total <span class="ot">&lt;-</span> bonds_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.43</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>    short_term_total <span class="ot">&lt;-</span> short_term_total</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">75</span>) {</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    us_equities_total <span class="ot">&lt;-</span> us_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.19</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    int_equities_total <span class="ot">&lt;-</span> int_equities_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.13</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    bonds_total <span class="ot">&lt;-</span> bonds_total <span class="sc">+</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.62</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>    short_term_total <span class="ot">&lt;-</span> short_term_total <span class="sc">*</span> total_contributions[i] <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Need to account for market returns for each asset, will use long run average</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>  us_equities_total <span class="ot">&lt;-</span> <span class="fu">round</span>(us_equities_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> us_equity_yearly[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>  int_equities_total <span class="ot">&lt;-</span> <span class="fu">round</span>(int_equities_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> int_equity_yearly[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>  bonds_total <span class="ot">&lt;-</span> <span class="fu">round</span>(bonds_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bond_yearly[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>  short_term_total <span class="ot">&lt;-</span> <span class="fu">round</span>(short_term_total <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> short_term_yearly[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-55"><a href="#cb32-55" aria-hidden="true" tabindex="-1"></a>orp_total_investment <span class="ot">&lt;-</span> us_equities_total <span class="sc">+</span> int_equities_total <span class="sc">+</span> bonds_total <span class="sc">+</span> short_term_total</span>
<span id="cb32-56"><a href="#cb32-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-57"><a href="#cb32-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-58"><a href="#cb32-58" aria-hidden="true" tabindex="-1"></a><span class="co"># General rule of thumb is withdrawing 4% of the value per year</span></span>
<span id="cb32-59"><a href="#cb32-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-60"><a href="#cb32-60" aria-hidden="true" tabindex="-1"></a>first_month_withdrawal <span class="ot">&lt;-</span> <span class="fu">round</span>((orp_total_investment <span class="sc">*</span> <span class="fl">0.04</span>) <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After working for 20 years, the CUNY employee would end up with a total of $675,728.3 in their ORP retirement account. Typically, individuals would withdraw about 4% of their retirement account’s value per year. So, we will take the assumption that our individual will withdraw 4% of their ORP account every year until they pass away. Thus, for their first month of retirement, they would withdraw $2,252.43.</p>
<p>Comparing the first month’s retirement payout for each plan, we find that the TRS plan provides a bigger payout than the ORP, with $4,338.93 versus $2,252.43 from the ORP. While the TRS plan has shown its benefits in early retirement stages as compared to ORP, it still is not yet clear which plan will be most beneficial in the long term.</p>
<p>Next, we will take a look at the long-term average analysis, with future projections of our data based on the long-run averages we calculated earlier.</p>
</section>
</section>
<section id="long-term-average-analysis" class="level2">
<h2 class="anchored" data-anchor-id="long-term-average-analysis">Long-Term Average Analysis</h2>
<p>The “first month of retirement” dollar value provides little insight, as it is not representative of the funds that will support the employee throughout the entire retirement period. The TRS will always guarantee an income for the remainder of an employee’s life, while the ORP carries more market risk and can be exhausted if the employee lives a very long time in retirement.</p>
<p>For the purposes of this projection, we will take the assumption that our hypothetical employee will die at age 77, 23 years after retirement.</p>
<p>We will modify our above simulation to project the employee’s retirement benefit from the TRS plan and the annual withdrawal amount from retirement (55) until death (77). To accommodate the necessary cost-of-living-adjustments for the TRS and the future market returns (ORP), we will use the long-run averages from earlier. As mentioned earlier, this “fixed rate” assumption is not entirely representative of the possible future values, but we will accommodate this in a later section.</p>
<p>For the TRS retirement plan, the first year’s retirement benefit is calculated as mentioned above as:</p>
<ul>
<li><span class="math inline">1.67\% * \text{FAS} * N</span> if <span class="math inline">N \leq 20</span></li>
<li><span class="math inline">1.75\% * \text{FAS} * N</span> if <span class="math inline">N = 20</span></li>
<li><span class="math inline">(35\% + 2\% * N) * \text{FAS}</span> if <span class="math inline">N \geq 20</span></li>
</ul>
<p>(where the FAS is the final average salary of the LAST THREE years of employment).</p>
<p>Following this, for the remainder of retirement, the benefit is increased annually by 50% of the CPI, but this is capped at 1% and 3%.</p>
<p>Accommodating the above conditions, below is the code calculating the annual and monthly retirement benefit that a CUNY employee would receive in retirement with the TRS plan.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current age: 55</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated death age: 77</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Long Run Averages:</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>inflation_avg <span class="ot">&lt;-</span> long_run_averages<span class="sc">$</span>long_run_inflation</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>yearly_retire_benefit <span class="ot">&lt;-</span> retirement_benefit_trs</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>col_trs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"annual_retirement_benefit"</span>, <span class="st">"monthly_payout"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>trs_retirement <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="fu">length</span>(col_trs)))</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">77</span>) {</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  monthly_pay <span class="ot">&lt;-</span> <span class="fu">round</span>(yearly_retire_benefit <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  trs_retirement <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trs_retirement, <span class="fu">c</span>(i, yearly_retire_benefit, monthly_pay))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CPI adjustment for the next year, using long run inflation average</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  adjusted_benefit <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    inflation_avg <span class="sc">/</span> <span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">round</span>(yearly_retire_benefit <span class="sc">*</span> <span class="fl">1.01</span>, <span class="dv">2</span>),</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    inflation_avg <span class="sc">/</span> <span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="fu">round</span>(yearly_retire_benefit <span class="sc">*</span> <span class="fl">1.03</span>, <span class="dv">2</span>),</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="fu">round</span>(yearly_retire_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> ((inflation_avg <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  , <span class="dv">2</span>))</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  yearly_retire_benefit <span class="ot">&lt;-</span> adjusted_benefit</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(trs_retirement) <span class="ot">=</span> col_trs</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(trs_retirement, <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Annual Payout"</span>, <span class="st">"Monthly Payout"</span>)), </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 6: Employee's TRS Plan Payout in Retirement"</span>,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-720ce193884a34167e0d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-720ce193884a34167e0d">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 6: Employee's TRS Plan Payout in Retirement<\/caption>","data":[[55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77],[52067.2,52738.87,53419.2,54108.31,54806.31,55513.31,56229.43,56954.79,57689.51,58433.7,59187.49,59951.01,60724.38,61507.72,62301.17,63104.86,63918.91,64743.46,65578.64999999999,66424.61,67281.49000000001,68149.42,69028.55],[4338.93,4394.91,4451.6,4509.03,4567.19,4626.11,4685.79,4746.23,4807.46,4869.47,4932.29,4995.92,5060.36,5125.64,5191.76,5258.74,5326.58,5395.29,5464.89,5535.38,5606.79,5679.12,5752.38]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Age<\/th>\n      <th>Annual Payout<\/th>\n      <th>Monthly Payout<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2]},{"name":"Age","targets":0},{"name":"Annual Payout","targets":1},{"name":"Monthly Payout","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>From this TRS projection, we can observe that the employee’s annual payout remains between about $52,000 and $70,000 until their time of death. So, while the value of their annual payout does not increase much over time, they are guaranteed a decent share of income each year, about $4,000-$6,000 a month. However, upon death, there are no more benefits for the employee’s family, which is something else one may want to consider when selecting a retirement plan.</p>
<p>Next, we’ll take a look at the future projections for the CUNY ORP. For this plan, the contributions end once the employee retires, however, the retirement account continues to fluctuate based on market behaviors, which can lead to very positive returns if the market is strong.</p>
<p>Below is the code for the data frame which assumes a 4% withdrawal rate for each year and applies the appropriate market fluctuations for each year of retirement based on our long-run averages calculated earlier.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Current age: 55</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimated death age: 77</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Long Run Averages:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>us_equity_avg <span class="ot">&lt;-</span> long_run_averages<span class="sc">$</span>long_run_us_equity_returns</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>int_equity_avg <span class="ot">&lt;-</span> long_run_averages<span class="sc">$</span>long_run_int_equity_returns</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>bond_avg <span class="ot">&lt;-</span> long_run_averages<span class="sc">$</span>long_run_bond_value</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>short_term_avg <span class="ot">&lt;-</span> long_run_averages<span class="sc">$</span>long_run_short_term_value</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>remaining_total <span class="ot">&lt;-</span> orp_total_investment</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>remaining_us <span class="ot">&lt;-</span> us_equities_total</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>remaining_int <span class="ot">&lt;-</span> int_equities_total</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>remaining_bond <span class="ot">&lt;-</span> bonds_total</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>remaining_short_term <span class="ot">&lt;-</span> short_term_total</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>col_orp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"yearly_withdrawal"</span>, <span class="st">"monthly_withdrawal"</span>, <span class="st">"remaining_us_equities_amount"</span>, <span class="st">"remaining_int_equities_amount"</span>, <span class="st">"remaining_bond_amount"</span>, <span class="st">"remaining_short_term_amount"</span>, <span class="st">"remaining_amount"</span>)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>orp_retirement <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="fu">length</span>(col_orp)))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">77</span>) {</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (remaining_total <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    year_withdrawal <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_total <span class="sc">*</span> <span class="fl">0.04</span>, <span class="dv">2</span>)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    month_withdrawal <span class="ot">=</span> <span class="fu">round</span>(year_withdrawal <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    remaining_us <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    remaining_int <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_int <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    remaining_bond <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_bond <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    remaining_short_term <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_short_term <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    remaining_total <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us <span class="sc">+</span> remaining_int <span class="sc">+</span> remaining_bond <span class="sc">+</span> remaining_short_term, <span class="dv">2</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    orp_retirement <span class="ot">&lt;-</span> <span class="fu">rbind</span>(orp_retirement, <span class="fu">c</span>(i, year_withdrawal, month_withdrawal, remaining_us, remaining_int, remaining_bond, remaining_short_term, remaining_total))</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Need to adjust the total based on market fluctuations</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    remaining_us <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> us_equity_avg <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    remaining_int <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_int <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> int_equity_avg <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    remaining_bond <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_bond <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bond_avg <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    remaining_short_term <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_short_term <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> short_term_avg <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"No More Funds! Stopped at age "</span>, i))</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(orp_retirement) <span class="ot">=</span> col_orp</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(orp_retirement, <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Yearly Withdrawal"</span>, <span class="st">"Monthly Withdrawal"</span>, <span class="st">"Remaining in US Equities"</span>, <span class="st">"Remaining in International Equities"</span>, <span class="st">"Remaining in Bonds"</span>, <span class="st">"Remaining in Short-Term Debts"</span>, <span class="st">"Total Remaining"</span>)), </span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 7: Employee's ORP Withdrawal in Retirement"</span>,</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1ad66c838d3a6a75bdd0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1ad66c838d3a6a75bdd0">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 7: Employee's ORP Withdrawal in Retirement<\/caption>","data":[[55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77],[27029.13,25947.97,27584.43,29335.34,31208.6,33212.65,35356.5,37649.82,40102.92,42726.85,45533.41,48535.23,51745.82,55179.61,58852.05,62779.67,66980.13,71472.34,76276.5,81414.25,86908.7,92784.59,99068.37],[2252.43,2162.33,2298.7,2444.61,2600.72,2767.72,2946.38,3137.49,3341.91,3560.57,3794.45,4044.6,4312.15,4598.3,4904.34,5231.64,5581.68,5956.03,6356.38,6784.52,7242.39,7732.05,8255.700000000001],[432127.17,462963.76,496000.86,531395.48,569315.87,609942.25,653467.73,700099.1899999999,750058.27,803582.4300000001,860926.0699999999,922361.75,988181.48,1058698.11,1134246.81,1215186.66,1301902.38,1394806.14,1494339.5,1600975.56,1715221.17,1837619.36,1968751.88],[172087.58,182699.18,193965.14,205925.81,218624.02,232105.25,246417.79,261612.89,277744.99,294871.85,313054.83,332359.05,352853.64,374612.01,397712.08,422236.6,448273.4,475915.73,505262.6,536419.11,569496.85,604614.3100000001,641897.25],[44484.38,43947.72,43417.54,42893.75,42376.28,41865.05,41359.99,40861.03,40368.09,39881.09,39399.96,38924.64,38455.06,37991.14,37532.81,37080.01,36632.68,36190.74,35754.13,35322.8,34896.66,34475.66,34059.74],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[648699.13,689610.66,733383.54,780215.04,830316.17,883912.55,941245.51,1002573.11,1068171.35,1138335.37,1213380.86,1293645.44,1379490.18,1471301.26,1569491.7,1674503.27,1786808.46,1906912.61,2035356.23,2172717.47,2319614.68,2476709.33,2644708.87]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Age<\/th>\n      <th>Yearly Withdrawal<\/th>\n      <th>Monthly Withdrawal<\/th>\n      <th>Remaining in US Equities<\/th>\n      <th>Remaining in International Equities<\/th>\n      <th>Remaining in Bonds<\/th>\n      <th>Remaining in Short-Term Debts<\/th>\n      <th>Total Remaining<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5,6,7]},{"name":"Age","targets":0},{"name":"Yearly Withdrawal","targets":1},{"name":"Monthly Withdrawal","targets":2},{"name":"Remaining in US Equities","targets":3},{"name":"Remaining in International Equities","targets":4},{"name":"Remaining in Bonds","targets":5},{"name":"Remaining in Short-Term Debts","targets":6},{"name":"Total Remaining","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>remainder_heirs <span class="ot">&lt;-</span> orp_retirement <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(age) <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(remaining_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on the above table, we observe that the annual and monthly withdrawals initially are less than that of the TRS plan. However, over time, these withdrawals start exceeding the TRS payouts. Additionally, based on our market fluctuation assumptions, we have that at the time of death, the employee’s retirement account has grown to over $2,500,000, money that can be passed down to their family (e.g.&nbsp;spouse, heirs, etc.), something that the TRS plan does not offer. In this above case, the risk taken for the ORP plan has paid off significantly, allowing the employee to live comfortably during retirement and have money leftover for their family upon their death.</p>
<p>Below, we will take a closer look at the comparison of minimum, maximum, and average monthly payouts between the TRS and the ORP retirement plans.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>combined_retirement_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(trs_retirement, orp_retirement, <span class="at">by =</span> <span class="st">'age'</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>monthly_amount <span class="ot">&lt;-</span> combined_retirement_df <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"monthly_payout"</span>, <span class="st">"monthly_withdrawal"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_TRS =</span> monthly_payout,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">monthly_ORP =</span> monthly_withdrawal)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>monthly_amount_summary <span class="ot">&lt;-</span> monthly_amount <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">min_month_trs =</span> <span class="fu">min</span>(monthly_TRS),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_month_orp =</span> <span class="fu">min</span>(monthly_ORP),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_month_trs =</span> <span class="fu">max</span>(monthly_TRS),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">max_month_orp =</span> <span class="fu">max</span>(monthly_ORP),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_month_trs =</span> <span class="fu">round</span>(<span class="fu">mean</span>(monthly_TRS), <span class="dv">2</span>),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_month_orp =</span> <span class="fu">round</span>(<span class="fu">mean</span>(monthly_ORP), <span class="dv">2</span>))</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(monthly_amount_summary, <span class="fu">c</span>(<span class="st">"Minimum Monthly </span><span class="sc">\n</span><span class="st">TRS Payout"</span>, <span class="st">"Minimum Monthly </span><span class="sc">\n</span><span class="st">ORP Payout"</span>, <span class="st">"Maximum Monthly </span><span class="sc">\n</span><span class="st">TRS Payout"</span>, <span class="st">"Maximum Monthly </span><span class="sc">\n</span><span class="st">ORP Payout"</span>, <span class="st">"Average Monthly </span><span class="sc">\n</span><span class="st">TRS Payout"</span>, <span class="st">"Average Monthly </span><span class="sc">\n</span><span class="st">ORP Payout"</span>)), </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 8: Summary Monthly Payout for each Retirement Plan"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4f4fea892a523f402b4f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4f4fea892a523f402b4f">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 8: Summary Monthly Payout for each Retirement Plan<\/caption>","data":[[4338.93],[2162.33],[5752.38],[8255.700000000001],[5013.99],[4448.13]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Minimum Monthly \nTRS Payout<\/th>\n      <th>Minimum Monthly \nORP Payout<\/th>\n      <th>Maximum Monthly \nTRS Payout<\/th>\n      <th>Maximum Monthly \nORP Payout<\/th>\n      <th>Average Monthly \nTRS Payout<\/th>\n      <th>Average Monthly \nORP Payout<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5]},{"name":"Minimum Monthly \nTRS Payout","targets":0},{"name":"Minimum Monthly \nORP Payout","targets":1},{"name":"Maximum Monthly \nTRS Payout","targets":2},{"name":"Maximum Monthly \nORP Payout","targets":3},{"name":"Average Monthly \nTRS Payout","targets":4},{"name":"Average Monthly \nORP Payout","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>From table 8, we find that the minimum monthly payout for TRS is higher than that of the ORP retirement plan, by about $2,000. On the other hand, the maximum ORP monthly withdrawal reaches as high as $8,255.70, compared to only $5752.38 from the TRS, demonstrating an instance of a positive market return over 23 years for the ORP. The average monthly payout between each plan is much closer, with TRS edging out slightly at $5,013.99 compared to ORP’s $4,448.13.</p>
<p>To take a closer look at the gaps between monthly payouts between each retirement plan for each year of the employee’s retirement, we will create the following data frame.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>monthly_amount_gaps <span class="ot">&lt;-</span> monthly_amount <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap =</span> <span class="fu">round</span>(<span class="fu">abs</span>(monthly_TRS <span class="sc">-</span> monthly_ORP), <span class="dv">2</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">greater =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>           monthly_TRS <span class="sc">&gt;</span> monthly_ORP <span class="sc">~</span> <span class="st">"TRS"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>           monthly_ORP <span class="sc">&gt;</span> monthly_TRS <span class="sc">~</span> <span class="st">"ORP"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">.default =</span> <span class="st">"EQUAL"</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">|&gt;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"gap"</span>, <span class="st">"greater"</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="fu">setNames</span>(monthly_amount_gaps, <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Monthly Payment Gap"</span>, <span class="st">"Plan with Larger Monthly Payout"</span>)), </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">caption =</span> <span class="st">"Table 9: Monthly Payout Gap per Year"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">rownames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-572310d3c9ab8c38ea17" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-572310d3c9ab8c38ea17">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 9: Monthly Payout Gap per Year<\/caption>","data":[[55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77],[2086.5,2232.58,2152.9,2064.42,1966.47,1858.39,1739.41,1608.74,1465.55,1308.9,1137.84,951.3200000000001,748.21,527.34,287.42,27.1,255.1,560.74,891.49,1249.14,1635.6,2052.93,2503.32],["TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","TRS","ORP","ORP","ORP","ORP","ORP","ORP","ORP"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Age<\/th>\n      <th>Monthly Payment Gap<\/th>\n      <th>Plan with Larger Monthly Payout<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"Age","targets":0},{"name":"Monthly Payment Gap","targets":1},{"name":"Plan with Larger Monthly Payout","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>From this data table, there is a more evident pattern between the differences in monthly payouts by retirement plan. In the first 16 years of the employee’s retirement, the TRS retirement plan edges ahead of ORP by a range of about $27 to as much as $2,100. After the employee turns 71, the ORP takes the lead until their death from a range of $255 to over $2,500 at the time of death. So while the TRS provides a steady stream of income to their employee’s during retirement, taking the risk with the ORP may pay out better in the long term.</p>
<p>Below is a bar plot providing a clearer distinction between the monthly payouts/withdrawals of each plan over the course of the employee’s retirement.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>monthly_amount <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>age, <span class="at">names_to =</span> <span class="st">"plan"</span>, <span class="at">values_to =</span> <span class="st">"monthly_amt"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> monthly_amt, <span class="at">fill =</span> plan)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Amount Received during Retirement for Employee"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"ORP vs TRS"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Monthly Amount ($)"</span>) <span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Retirement</span><span class="sc">\n</span><span class="st">Plan"</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"ORP"</span>, <span class="st">"TRS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/retirement_monthly_payout_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Like we observed earlier, we find that the ORP takes over with the higher amount of monthly pay out from TRS when our employee turns 71, but of course this is with our long-run average assumptions for market returns which can be limiting.</p>
<p>Each retirement plan has different advantages and disadvantages based on various factors. TRS provides their retirees with a guaranteed comfortable salary until their death, but does not provide any funds beyond this. ORP retirement accounts will fluctuate with the market and does not guarantee a payout every year of retirement. However, if the market works in your favor more times than not, retirees may have money saved even beyond their death to pass down to family.</p>
<p>Before providing our recommendation, we will run a few more simulations using bootstrap sampling to gain a larger perspective on each retirement plan.</p>
</section>
<section id="bootstrap-monte-carlo-comparison" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-monte-carlo-comparison">Bootstrap (Monte Carlo) Comparison</h2>
<p>Our findings above are limited based on long-run averages calculated from the original data we retrieved. To mitigate this, we will use our historical data to generate 200 bootstrap histories for a Monte Carlo analysis. We will use bootstrap sampling to generate the values for the “while working” and the “while retired” periods of the model. More specifically, we will be generating values with bootstrapping for all the data we originally retrieved from the APIs (wage growth, inflation, US equity returns, International equity returns, bond returns, short-term debt returns). So we will no longer be assuming the same constant long-term average values for the retirement predictions.</p>
<section id="trs-1" class="level3">
<h3 class="anchored" data-anchor-id="trs-1">TRS</h3>
<p>Below is the code used to simulate the TRS retirement plan for our new 200 bootstrap samples. We will set our “seed” to 100, to allow replication of our results in the future. We will store each of our 200 data frames in the list <code>trs_bootstrap_histories</code>, for ease of access later.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>) <span class="co"># maintains the same randomness each time we run the code</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage Growth</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>all_metrics_summary_no_yr <span class="ot">&lt;-</span> all_metrics_summary <span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"year"</span>))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>num_bootstraps <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># want to run 200 "bootstrap histories"</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>trs_bootstrap_histories <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># Create a list to fill with all the ORP bootstrap data frames</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bootstraps) {</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create new bootstrap sample of the data</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  bootstrap_df <span class="ot">&lt;-</span> all_metrics_summary_no_yr <span class="sc">|&gt;</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">nrow</span>(all_metrics_summary_no_yr), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the new long run averages based on bootstrapped data</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  long_run_averages_bootstrap <span class="ot">&lt;-</span> bootstrap_df <span class="sc">|&gt;</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">long_run_wage_growth =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_wage_growth), <span class="dv">2</span>),</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_inflation =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_inflation), <span class="dv">2</span>),</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_us_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_us_equity_returns), <span class="dv">2</span>),</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_int_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_int_equity_returns), <span class="dv">2</span>),</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_bond_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_bond_value), <span class="dv">2</span>),</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_short_term_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_short_term_value), <span class="dv">2</span>))</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Salary adjustment based on inflation and wage growth</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  yearly_wage_growth_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_wage_growth</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  yearly_inflation_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_inflation</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  salary_vector_bootstrap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50000</span>)</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(yearly_wage_growth_bootstrap)) {</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    start_salary <span class="ot">=</span> salary_vector_bootstrap[j<span class="dv">-1</span>]</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">=</span> (start_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (yearly_wage_growth_bootstrap[j] <span class="sc">/</span> <span class="dv">100</span>))) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> (yearly_inflation_bootstrap[j] <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    salary_vector_bootstrap <span class="ot">=</span> <span class="fu">c</span>(salary_vector_bootstrap, salary)</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  yearly_salary_df_bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> (<span class="dv">2005</span><span class="sc">:</span><span class="dv">2024</span>),</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">salary =</span> salary_vector_bootstrap) <span class="sc">|&gt;</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">salary =</span> <span class="fu">round</span>(salary, <span class="dv">2</span>))</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRS Simulation</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Employees pay a fixed percentage of their paycheck into the pension fund</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>  trs_pension_bootstrap <span class="ot">&lt;-</span> yearly_salary_df_bootstrap <span class="sc">|&gt;</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tier_6 =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>      salary <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">45000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.035</span>,</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">55000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.045</span>,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.0575</span>,</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>      salary <span class="sc">&gt;</span> <span class="dv">100000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    ), <span class="dv">2</span>))</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. The retirement benefit is calculated based on the Final Average Salary of the employee (last three years of work)</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>  final_average_salary_bootstrap <span class="ot">&lt;-</span> yearly_salary_df_bootstrap <span class="sc">|&gt;</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">fas =</span> <span class="fu">round</span>(<span class="fu">mean</span>(salary), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(fas)</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>  retirement_benefit_trs_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(yearly_salary_df_bootstrap) <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">~</span> <span class="fl">0.0167</span> <span class="sc">*</span> final_average_salary_bootstrap <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df_bootstrap),</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(yearly_salary_df_bootstrap) <span class="sc">==</span> <span class="dv">20</span> <span class="sc">~</span> <span class="fl">0.0175</span> <span class="sc">*</span> final_average_salary_bootstrap <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df_bootstrap),</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(yearly_salary_df_bootstrap) <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">~</span> (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> <span class="fu">nrow</span>(yearly_salary_df_bootstrap)) <span class="sc">*</span> final_average_salary_bootstrap,</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>  ), <span class="dv">2</span>)</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>  inflation_avg_bootstrap <span class="ot">&lt;-</span> long_run_averages_bootstrap<span class="sc">$</span>long_run_inflation</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRS: During Retirement</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>  yearly_retire_benefit_bootstrap <span class="ot">&lt;-</span> retirement_benefit_trs_bootstrap</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a>  col_trs_bootstrap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"annual_retirement_benefit"</span>, <span class="st">"monthly_payout"</span>)</span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>  trs_retirement_bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="fu">length</span>(col_trs_bootstrap)))</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">77</span>) {</span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a>    monthly_pay_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(yearly_retire_benefit_bootstrap <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a>    trs_retirement_bootstrap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trs_retirement_bootstrap, <span class="fu">c</span>(k, yearly_retire_benefit_bootstrap, monthly_pay_bootstrap))</span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CPI adjustment for the next year, using long run inflation average</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a>    adjusted_benefit_bootstrap <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a>      inflation_avg_bootstrap <span class="sc">/</span> <span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">round</span>(yearly_retire_benefit_bootstrap <span class="sc">*</span> <span class="fl">1.01</span>, <span class="dv">2</span>),</span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a>      inflation_avg_bootstrap <span class="sc">/</span> <span class="dv">2</span> <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="fu">round</span>(yearly_retire_benefit_bootstrap <span class="sc">*</span> <span class="fl">1.03</span>, <span class="dv">2</span>),</span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">round</span>(yearly_retire_benefit_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> ((inflation_avg_bootstrap <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a>    , <span class="dv">2</span>))</span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a>    yearly_retire_benefit_bootstrap <span class="ot">&lt;-</span> adjusted_benefit_bootstrap</span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(trs_retirement_bootstrap) <span class="ot">=</span> col_trs_bootstrap</span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a>  trs_bootstrap_histories <span class="ot">&lt;-</span> <span class="fu">append</span>(trs_bootstrap_histories, <span class="fu">list</span>(trs_retirement_bootstrap)) <span class="co"># Appends the list with the TRS bootstrap data frame</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="orp-1" class="level3">
<h3 class="anchored" data-anchor-id="orp-1">ORP</h3>
<p>Below is the code used to simulate the ORP for our new 200 bootstrap samples. We will set the same “seed” to 100, to allow replication of our results in the future and to keep some consistency by utilizing the same bootstrap as we did in our previous code with TRS. Similarly, we will store each of our 200 data frames in the list <code>orp_bootstrap_histories</code>, for ease of access later.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>) <span class="co"># maintains the same randomness each time we run the code</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage Growth</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>all_metrics_summary_no_yr <span class="ot">&lt;-</span> all_metrics_summary <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"year"</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>num_bootstraps <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># want to run 200 "bootstrap histories"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>ran_out <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># number of times the ORP retirement fund ran out before death</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>orp_bootstrap_histories <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># Create a list to fill with all the ORP bootstrap data frames</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_bootstraps) {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create new bootstrap sample of the data</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  bootstrap_df <span class="ot">&lt;-</span> all_metrics_summary_no_yr <span class="sc">|&gt;</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">nrow</span>(all_metrics_summary_no_yr), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the new long run averages based on bootstrapped data</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  long_run_averages_bootstrap <span class="ot">&lt;-</span> bootstrap_df <span class="sc">|&gt;</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">long_run_wage_growth =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_wage_growth), <span class="dv">2</span>),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_inflation =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_inflation), <span class="dv">2</span>),</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_us_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_us_equity_returns), <span class="dv">2</span>),</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_int_equity_returns =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_int_equity_returns), <span class="dv">2</span>),</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_bond_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_bond_value), <span class="dv">2</span>),</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">long_run_short_term_value =</span> <span class="fu">round</span>(<span class="fu">mean</span>(annual_short_term_value), <span class="dv">2</span>))</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Salary adjustment based on inflation and wage growth</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  yearly_wage_growth_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_wage_growth</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>  yearly_inflation_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_inflation</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  salary_vector_bootstrap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50000</span>)</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(yearly_wage_growth_bootstrap)) {</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    start_salary <span class="ot">=</span> salary_vector_bootstrap[i<span class="dv">-1</span>]</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">=</span> (start_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> (yearly_wage_growth_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>))) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> (yearly_inflation_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    salary_vector_bootstrap <span class="ot">=</span> <span class="fu">c</span>(salary_vector_bootstrap, salary)</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  yearly_salary_df_bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> (<span class="dv">2005</span><span class="sc">:</span><span class="dv">2024</span>),</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">salary =</span> salary_vector_bootstrap) <span class="sc">|&gt;</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">salary =</span> <span class="fu">round</span>(salary, <span class="dv">2</span>))</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ORP Simulation</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>  orp_account_bootstrap <span class="ot">&lt;-</span> yearly_salary_df_bootstrap <span class="sc">|&gt;</span></span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">orp_contributions =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>      salary <span class="sc">&lt;=</span> <span class="dv">45000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.03</span>,</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">45000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.035</span>,</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">55000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.045</span>,</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>      (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.0575</span>,</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>      salary <span class="sc">&gt;</span> <span class="dv">100000</span> <span class="sc">~</span> salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>    ), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">employer_contributions =</span> <span class="fu">round</span>(<span class="fu">case_when</span>(</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>      (year <span class="sc">-</span> <span class="dv">2005</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">&lt;=</span> <span class="dv">7</span> <span class="sc">~</span> <span class="fl">0.08</span> <span class="sc">*</span> salary,</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fl">0.1</span> <span class="sc">*</span> salary</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    ), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">total_contributions =</span> orp_contributions <span class="sc">+</span> employer_contributions) <span class="sc">|&gt;</span></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> (<span class="dv">35</span><span class="sc">:</span><span class="dv">54</span>))</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectors from the data frame to run a for loop on to calculate total retirement benefit by the time of retirement</span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>  age_bootstrap <span class="ot">&lt;-</span> orp_account_bootstrap<span class="sc">$</span>age</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>  total_contributions_bootstrap <span class="ot">&lt;-</span> orp_account_bootstrap<span class="sc">$</span>total_contributions</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vectors for each market's returns</span></span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>  us_equity_yearly_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_us_equity_returns</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>  int_equity_yearly_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_int_equity_returns</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>  bond_yearly_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_bond_value</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>  short_term_yearly_bootstrap <span class="ot">&lt;-</span> bootstrap_df<span class="sc">$</span>annual_short_term_value</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initially no investment into any of these assets</span></span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>  us_equities_total_bootstrap <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>  int_equities_total_bootstrap <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>  bonds_total_bootstrap <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>  short_term_total_bootstrap <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Asset allocation based on age of employee</span></span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>      us_equities_total_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.54</span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>      int_equities_total_bootstrap <span class="ot">&lt;-</span> int_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.36</span></span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>      bonds_total_bootstrap <span class="ot">&lt;-</span> bonds_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>      short_term_total_bootstrap <span class="ot">&lt;-</span> short_term_total_bootstrap</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">60</span>) {</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>      us_equities_total_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.47</span></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>      int_equities_total_bootstrap <span class="ot">&lt;-</span> int_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.32</span></span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>      bonds_total_bootstrap <span class="ot">&lt;-</span> bonds_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.21</span></span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>      short_term_total_bootstrap <span class="ot">&lt;-</span> short_term_total_bootstrap</span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> age[i] <span class="sc">&lt;</span> <span class="dv">75</span>) {</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>      us_equities_total_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.34</span></span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>      int_equities_total_bootstrap <span class="ot">&lt;-</span> int_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.23</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>      bonds_total_bootstrap <span class="ot">&lt;-</span> bonds_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.43</span></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>      short_term_total_bootstrap <span class="ot">&lt;-</span> short_term_total_bootstrap</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (age[i] <span class="sc">&gt;=</span> <span class="dv">75</span>) {</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a>      us_equities_total_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.19</span></span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a>      int_equities_total_bootstrap <span class="ot">&lt;-</span> int_equities_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.13</span></span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a>      bonds_total_bootstrap <span class="ot">&lt;-</span> bonds_total_bootstrap <span class="sc">+</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.62</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a>      short_term_total_bootstrap <span class="ot">&lt;-</span> short_term_total_bootstrap <span class="sc">*</span> total_contributions_bootstrap[i] <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Need to account for each year's aggregated market return</span></span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a>    us_equities_total_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(us_equities_total_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> us_equity_yearly_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a>    int_equities_total_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(int_equities_total_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> int_equity_yearly_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a>    bonds_total_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(bonds_total_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bond_yearly_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a>    short_term_total_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(short_term_total_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> short_term_yearly_bootstrap[i] <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a>  orp_total_investment_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap <span class="sc">+</span> int_equities_total_bootstrap <span class="sc">+</span> bonds_total_bootstrap <span class="sc">+</span> short_term_total_bootstrap</span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ORP: During Retirement</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a>  us_equity_avg_bootstrap <span class="ot">&lt;-</span> long_run_averages_bootstrap<span class="sc">$</span>long_run_us_equity_returns</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a>  int_equity_avg_bootstrap <span class="ot">&lt;-</span> long_run_averages_bootstrap<span class="sc">$</span>long_run_int_equity_returns</span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a>  bond_avg_bootstrap <span class="ot">&lt;-</span> long_run_averages_bootstrap<span class="sc">$</span>long_run_bond_value</span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a>  short_term_avg_bootstrap <span class="ot">&lt;-</span> long_run_averages_bootstrap<span class="sc">$</span>long_run_short_term_value</span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a>  remaining_total_bootstrap <span class="ot">&lt;-</span> orp_total_investment_bootstrap</span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a>  remaining_us_bootstrap <span class="ot">&lt;-</span> us_equities_total_bootstrap</span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a>  remaining_int_bootstrap <span class="ot">&lt;-</span> int_equities_total_bootstrap</span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a>  remaining_bond_bootstrap <span class="ot">&lt;-</span> bonds_total_bootstrap</span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a>  remaining_short_term_bootstrap <span class="ot">&lt;-</span> short_term_total_bootstrap</span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a>  col_orp_bootstrap <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"yearly_withdrawal"</span>, <span class="st">"monthly_withdrawal"</span>, <span class="st">"remaining_us_equities_amount"</span>, <span class="st">"remaining_int_equities_amount"</span>, <span class="st">"remaining_bond_amount"</span>, <span class="st">"remaining_short_term_amount"</span>, <span class="st">"remaining_amount"</span>)</span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a>  orp_retirement_bootstrap <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="dv">0</span>, <span class="at">ncol =</span> <span class="fu">length</span>(col_orp_bootstrap)))</span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accounting for yearly withdrawals and market fluctuations each year</span></span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">55</span><span class="sc">:</span><span class="dv">77</span>) {</span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (remaining_total_bootstrap <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a>      year_withdrawal_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_total_bootstrap <span class="sc">*</span> <span class="fl">0.04</span>, <span class="dv">2</span>)</span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a>      month_withdrawal_bootstrap <span class="ot">=</span> <span class="fu">round</span>(year_withdrawal_bootstrap <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>)</span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-149"><a href="#cb40-149" aria-hidden="true" tabindex="-1"></a>      remaining_us_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us_bootstrap <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb40-150"><a href="#cb40-150" aria-hidden="true" tabindex="-1"></a>      remaining_int_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_int_bootstrap <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb40-151"><a href="#cb40-151" aria-hidden="true" tabindex="-1"></a>      remaining_bond_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_bond_bootstrap <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb40-152"><a href="#cb40-152" aria-hidden="true" tabindex="-1"></a>      remaining_short_term_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_short_term_bootstrap <span class="sc">*</span> <span class="fl">0.96</span>, <span class="dv">2</span>)</span>
<span id="cb40-153"><a href="#cb40-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-154"><a href="#cb40-154" aria-hidden="true" tabindex="-1"></a>      remaining_total_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us_bootstrap <span class="sc">+</span> remaining_int_bootstrap <span class="sc">+</span> remaining_bond_bootstrap <span class="sc">+</span> remaining_short_term_bootstrap, <span class="dv">2</span>)</span>
<span id="cb40-155"><a href="#cb40-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-156"><a href="#cb40-156" aria-hidden="true" tabindex="-1"></a>      orp_retirement_bootstrap <span class="ot">&lt;-</span> <span class="fu">rbind</span>(orp_retirement_bootstrap, <span class="fu">c</span>(i, year_withdrawal_bootstrap, month_withdrawal_bootstrap, remaining_us_bootstrap, remaining_int_bootstrap, remaining_bond_bootstrap, remaining_short_term_bootstrap, remaining_total_bootstrap))</span>
<span id="cb40-157"><a href="#cb40-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-158"><a href="#cb40-158" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Need to adjust the total based on market fluctuations</span></span>
<span id="cb40-159"><a href="#cb40-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-160"><a href="#cb40-160" aria-hidden="true" tabindex="-1"></a>      remaining_us_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_us_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> us_equity_avg_bootstrap <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-161"><a href="#cb40-161" aria-hidden="true" tabindex="-1"></a>      remaining_int_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_int_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> int_equity_avg_bootstrap <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-162"><a href="#cb40-162" aria-hidden="true" tabindex="-1"></a>      remaining_bond_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_bond_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bond_avg_bootstrap <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-163"><a href="#cb40-163" aria-hidden="true" tabindex="-1"></a>      remaining_short_term_bootstrap <span class="ot">&lt;-</span> <span class="fu">round</span>(remaining_short_term_bootstrap <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> short_term_avg_bootstrap <span class="sc">/</span> <span class="dv">100</span>), <span class="dv">2</span>)</span>
<span id="cb40-164"><a href="#cb40-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-165"><a href="#cb40-165" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb40-166"><a href="#cb40-166" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-167"><a href="#cb40-167" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Stops the loop if the retiree runs out of funds before death</span></span>
<span id="cb40-168"><a href="#cb40-168" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-169"><a href="#cb40-169" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"No More Funds! Stopped at age "</span>, i))</span>
<span id="cb40-170"><a href="#cb40-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-171"><a href="#cb40-171" aria-hidden="true" tabindex="-1"></a>      ran_out <span class="ot">&lt;-</span> ran_out <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb40-172"><a href="#cb40-172" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb40-173"><a href="#cb40-173" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-174"><a href="#cb40-174" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-175"><a href="#cb40-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-176"><a href="#cb40-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(orp_retirement_bootstrap) <span class="ot">=</span> col_orp_bootstrap</span>
<span id="cb40-177"><a href="#cb40-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-178"><a href="#cb40-178" aria-hidden="true" tabindex="-1"></a>  orp_bootstrap_histories <span class="ot">&lt;-</span> <span class="fu">append</span>(orp_bootstrap_histories, <span class="fu">list</span>(orp_retirement_bootstrap)) <span class="co"># Appends the list with the ORP bootstrap data frame</span></span>
<span id="cb40-179"><a href="#cb40-179" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After running these simulations, I would like to take a closer look at the various results for each of the retirement plans. Specifically, for the ORP, I would like to find out whether or not there were instances where the employee ran out of funds before death, due to the volatility and unpredictability of the market, it is possible that the ORP retirement account reacts differently in each instance.</p>
<p>From the data, we find that in every bootstrap sample of the ORP, the employee still has funds remaining in their retirement account, so 0% of the time does the employee actually run out of funds to support them in retirement. So, maybe given the market patterns over the past 20 years, it would make sense for employees to consider the ORP over the TRS, given that they will more than likely have enough funds to support them well into retirement and even for their families after they pass.</p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-e74776bd314974b46948" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e74776bd314974b46948">{"x":{"filter":"none","vertical":false,"caption":"<caption>Table 10: ORP Retirement Account Remaining Total<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200],[409426.76,5491726.15,578752.85,7926550.5,8332533.65,355774.7,1169472.15,2370427.76,5593079.21,887459.14,1802786.36,94840477.64,465509.24,12065393.78,19557489.79,9190703.359999999,2958469.86,4471868.65,29292682.58,605680.49,25262356.78,3800993.83,7593526.7,14864824.69,6198870.51,7299863.89,2247882.37,14747880.96,3630330.37,517395.75,3099208.1,26176859.27,2032211.07,1644352.44,3253120.39,621529.99,3915214.71,11047328.21,2349712,10140949.47,230431.79,3679156.56,2119933.43,998921.3100000001,892722.72,940067.79,1516598.41,9607093.27,2625683.46,2388238.26,12493007.85,4733193.18,881586.38,6933016.98,939560.51,7437465.96,8175895.48,8973179.15,8982979.630000001,7038592.79,15575965,592260.85,20034951.28,4615145.29,1750911.69,13364516.73,2646631.21,46401420.33,7684705.49,139132.68,18100292.89,8878602.32,872012.4,732251.1800000001,2615063.72,630328.58,110899.75,393283.51,12050291.29,679061.21,1723442.81,878110.73,1124751.48,337606.83,2686969.66,16405241.47,3135532.94,1125112.07,1716445.22,2083352.63,1845124.57,5429957.03,8574682.710000001,70805374.52,6054600.13,2022272.84,1618142.28,3488007.74,494004.45,963659.0699999999,1032449.55,5431675.28,967447.95,5673911.26,4983359.07,4998768.68,9876048.390000001,4982520.75,1418380.63,3564931.41,7628462.29,23924885.39,2401179.9,3803958.4,12049158.69,3423879.33,10255318.87,4189730.93,8277455.83,16153189.52,14607119.94,9600113.609999999,1408201.1,2290530.09,5725864.36,8024479.86,7145610.57,4171882.92,3003680.37,6116800.06,1896952.22,4535758.75,5067865.94,2417013.21,713013.27,2184107.26,8171196.4,2042073,554573.33,1290593.6,2955688.68,1184276.92,3853729.98,12028811.58,2772210.63,4903754.21,1183609.68,26326287.34,1617809.27,11914072.44,1116628.79,10287896.8,2714403.01,4122070.27,2769419.27,4069307.22,3330713.57,5867212.58,1800007.43,3912583,8130995.96,6577948.2,4682695.1,4303776.54,5989739.39,3845786.87,1498296.82,496474.76,1987201.64,14289541.85,2154473.39,4583887.83,7304836.35,1467171.27,1079342.41,4714179.98,1831789.7,2866232.02,6755002.34,14497506.2,1645077.56,15886907.61,4782700.36,734840.73,11615064.11,4781348.55,656214.36,437388.76,7292003.21,1505283.36,9415021.039999999,23779249.27,2374235.25,14378507.51,1278245.36,6120683.93,1191540.72,1495812.28,649743.17,410457.35]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Bootstrap Sample<\/th>\n      <th>ORP Retirement Account Total<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"Bootstrap Sample","targets":0},{"name":"ORP Retirement Account Total","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Next, I would also like to explore the probability that an employee with the ORP will have a higher monthly income than the employee with a TRS plan in retirement. To do so, I will take an aggregated average across all retirement years from each data frame then compare each ORP value against the respective TRS value for that bootstrap sample.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>orp_higher <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># counter to see how many times the overall orp monthly payout came out higher than the overall trs monthly payout</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>) {</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Need to calculate the average monthly payout for each ORP and TRS bootstrap and compare them</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Monthly Average for TRS Plan</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  trs_monthly_avg <span class="ot">&lt;-</span> trs_bootstrap_histories[[i]] <span class="sc">|&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">round</span>(<span class="fu">mean</span>(monthly_payout), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(avg)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Monthly Average for ORP</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  orp_monthly_avg <span class="ot">&lt;-</span> orp_bootstrap_histories[[i]] <span class="sc">|&gt;</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">round</span>(<span class="fu">mean</span>(monthly_withdrawal), <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(avg)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add to counter if the ORP monthly withdrawal was higher than that of TRS for the same bootstrap sample</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (orp_monthly_avg <span class="sc">&gt;</span> trs_monthly_avg) {</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    orp_higher <span class="ot">=</span> orp_higher <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From the pie chart below, we find that the monthly average for the ORP exceeds that of the TRS retirement plan a majority of the time at 105%. Further indicating that ORP may have an additional leg up on TRS by providing on average a higher monthly payment in retirement than that of TRS.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>prob_orp_greater <span class="ot">&lt;-</span> <span class="fu">round</span>((orp_higher <span class="sc">/</span> <span class="dv">200</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>prob_trs_greater <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">-</span> prob_orp_greater</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>retirement_plan <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ORP"</span>, <span class="st">"TRS"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>percentage_greater <span class="ot">&lt;-</span> <span class="fu">c</span>(prob_orp_greater, prob_trs_greater)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>df_greater <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(retirement_plan, percentage_greater)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>df_greater <span class="sc">|&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_labels =</span> <span class="fu">paste</span>(percentage_greater, <span class="st">"%"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y =</span> percentage_greater, <span class="at">fill =</span> retirement_plan)) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> percent_labels),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_polar</span>(<span class="st">"y"</span>, <span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Retirement Plan Monthly Payout Distribution"</span>) <span class="sc">+</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"Retirement Plan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/mc_q2_pie-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-driven-decision-recommendation" class="level2">
<h2 class="anchored" data-anchor-id="data-driven-decision-recommendation">Data-Driven Decision Recommendation</h2>
<p>The City University of New York (CUNY) provides its new employees with a choice between two retirement plan options: the defined-benefit Teachers Retirement System pension plan or the defined-contribution Optional Retirement Plan. When CUNY employees are between retirement plans, it is important to consider the possible factors in their decision.</p>
<p>In this project, we examined a hypothetical scenario where an individual started working at CUNY in 2005 at 35 years old with a starting salary of $50,000. This employee would go on to work until 2024 at age 54. We also assumed that the individual lived to the age 77. Taking these assumptions into consideration with historical data on wage growth, inflation, US equity market returns, International equity market returns, bond returns and short-term debt returns, we simulated two scenarios.</p>
<p>Based on our preliminary analysis, we found that the TRS plan provides a guaranteed steady stream of income for individuals throughout retirement. While ORP does not guarantee the same income that TRS provides, the individual’s account will grow alongside the market and could ultimately provide significant gains in the long term or could run out before the individual dies.</p>
<p>After generating many bootstrapping samples and re-running our retirement plan simulations for a Monte Carlo analysis, we found that the TRS plan provides a higher monthly payout in early retirement stages, but the ORP gains significant traction in later stages of retirement exceeding the monthly payout of the TRS. In all scenarios, we found that the individual always had money remaining in their account even after their death indicating favorable market returns. In 52.5% of the simulations, the average monthly payout of ORP exceeded that of TRS, further indicating an additional advantage for ORP. Our predictions are suggestive, not concrete, due to the limited 20-year data set and factors considered, highlighting the need for broader data and variables to improve accuracy. <strong>Past performance is no guarantee of future results.</strong></p>
<p>Based on our analysis with bootstrap sampling and simulations of each retirement plan, I would recommend that the employee commits to the Optional Retirement Plan (ORP). While at the beginning of retirement, ORP may not meet the same monthly payouts as TRS, this ground is eventually made up over time. Also, one can consider increasing the percentage of withdrawal from their retirement accounts to optimize their monthly payouts with ORP. Being able to have the option of having funds past your death for family members is also something I believe is important to consider, with TRS there is no option for that, with ORP and a favorable market return, individuals could make even more of their money back to pass down to family. Ultimately, decisions for retirement plans will depend on each employee’s unique circumstances and preferences.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ElissaLeung\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>